version: '3'
services:
  ipfs-dameon:
    image: golang
    volumes:
      - ./go-ipfs:/ipfs
      - ./storage-ipfs:/storage
      - ./conf-ipfs:/conf
    network_mode: "host"
    environment:
      - PATH=/ipfs:$PATH
      - IPFS_PATH=/storage
    cpu_count: 1
    cpu_percent: 90
    mem_limit: 256000000
    command: ipfs daemon
    restart: always
  ipfs-nginx:
    image: nginx
    network_mode: "host"
    volumes:
      - ./conf-nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    restart: always
  ipfs-redis:
    image: redis
    volumes:
      - ./redis-ipfs/redis.conf:/usr/local/etc/redis/redis.conf:ro
      - ./redis-ipfs/data:/data
    network_mode: "host"
    cpu_count: 1
    cpu_percent: 90
    mem_limit: 256000000
    command: [ "redis-server", "/usr/local/etc/redis/redis.conf" ]
    restart: always
