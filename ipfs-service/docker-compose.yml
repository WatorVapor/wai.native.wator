version: '3'
services:
  ipfs-dameon:
    image: golang
    volumes:
      - ./go-ipfs:/ipfs
      - ./storage-ipfs:/storage
      - ./conf-ipfs:/conf
    networks:
      - outside
    environment:
      - PATH=/ipfs:$PATH
      - IPFS_PATH=/storage
    deploy:
      resources:
        limits:
          cpus: '1.50'
          memory: 512M
        reservations:
          cpus: '1.00'
          memory: 256M
    command: ipfs daemon --enable-pubsub-experiment
  ipfs-nginx:
    image: nginx
    networks:
      - outside
    volumes:
      - ./conf-nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./conf-nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
      - ./conf-nginx/tcp.conf.d:/etc/nginx/tcp.conf.d:ro
    deploy:
      resources:
        limits:
          cpus: '1.00'
          memory: 64M
        reservations:
          cpus: '0.1'
          memory: 32M    
networks:
  outside:
    external:
      name: "host"

